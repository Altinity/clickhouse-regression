name: ğŸ”¬ Run Tests CI/CD on ARM
run-name: ğŸ”¬ ${{ inputs.custom_run_name || (inputs.suite == 'all' && format('{0} | Full Regression | ARM', inputs.version)) || format('{0} | {1} | ARM', inputs.version, inputs.suite)}}
  ${{ inputs.flags != 'none' && format(' | {0}', inputs.flags) || '' }}
  ${{ inputs.extra_args && format(' | {0}', inputs.extra_args) || '' }}

on:
  workflow_dispatch:
    inputs:
      package:
        description: "ğŸ“¦ Package. Either 'docker://' or 'https://'. Example: 'https://.../clickhouse-common-static_23.3.1.64_amd64.deb', or 'docker://altinity/clickhouse-server:24.3.5.48.altinitytest'"
        required: true
        type: string
        default: docker://altinity/clickhouse-server:24.3.12.76.altinitystable
      version:
        description: "ğŸ¯ Expected version. Example: 23.3.13.7.altinitytest"
        type: string
        required: true
        default: 24.3.12.76.altinitystable
      flags:
        description: "ğŸš© Flags"
        type: choice
        options: 
          - "--use-keeper" 
          - "none"
          - "--as-binary"
          - "--as-binary --use-keeper"
          - "--thread-fuzzer"
          - "--thread-fuzzer --use-keeper"
          - "--thread-fuzzer --as-binary"
          - "--thread-fuzzer --as-binary --use-keeper"
          - "--with-analyzer"
          - "--with-analyzer --use-keeper"
          - "--with-analyzer --as-binary"
          - "--with-analyzer --as-binary --use-keeper"
          - "--thread-fuzzer --with-analyzer"
          - "--thread-fuzzer --with-analyzer --use-keeper"
          - "--thread-fuzzer --with-analyzer --as-binary"
          - "--thread-fuzzer --with-analyzer --as-binary --use-keeper"
      suite:
        description: "ğŸ§ª Test suite to run (default: all)"
        type: choice
        options:
          - all
          - all_aws
          - all_gcs
          - aes_encryption
          - aggregate_functions
          - atomic_insert
          - alter_all
          - alter_replace_partition
          - alter_attach_partition
          - alter_move_partition
          - attach
          - base_58
          - benchmark_all
          - benchmark_aws
          - benchmark_gcs
          - benchmark_minio
          - clickhouse_keeper
          - clickhouse_keeper_failover
          - data_lakes
          - data_types
          - datetime64_extended_range
          - disk_level_encryption
          - dns
          - engines
          - example
          - extended_precision_data_types
          - functions
          - jwt_authentication
          - kafka
          - kerberos
          - key_value
          - ldap
          - lightweight_delete
          - memory
          - parquet_all
          - parquet
          - parquet_minio
          - parquet_s3
          - part_moves_between_shards
          - rbac
          - s3_all
          - s3_aws
          - s3_azure
          - s3_gcs
          - s3_minio
          - selects
          - session_timezone
          - ssl_server
          - tiered_storage_all
          - tiered_storage_aws
          - tiered_storage_gcs
          - tiered_storage_local
          - tiered_storage_minio
          - window_functions
      artifacts:
        description: "Artifact S3 bucket"
        type: choice
        options:
          - public
          - internal
      output_format:
        description: "ğŸ“œ Testflows output style."
        type: choice
        options:
          - nice-new-fails
          - brisk-new-fails
          - plain-new-fails
          - pnice-new-fails
          - new-fails
          - classic
          - nice
          - fails
          - slick
          - brisk
          - quiet
          - short
          - manual
          - dots
          - progress
          - raw
      ref:
        description: "Commit SHA to checkout. Default: current (empty string)."
        type: string
        default: ""
      extra_args:
        description: "ğŸ›ï¸ Extra test program arguments. Default: none (empty string)."
        type: string
        default: ""
      custom_run_name:
        description: 'ğŸ“ Custom run name (optional)'
        required: false

env:
  AWS_ACCESS_KEY_ID: ${{ secrets.AWS_REPORT_KEY_ID }}
  AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_REPORT_SECRET_ACCESS_KEY }}
  AWS_DEFAULT_REGION: ${{ secrets.AWS_REPORT_REGION }}
  DOCKER_USERNAME: ${{ secrets.DOCKER_USERNAME }}
  DOCKER_PASSWORD: ${{ secrets.DOCKER_PASSWORD }}
  CHECKS_DATABASE_HOST: ${{ secrets.CHECKS_DATABASE_HOST }}
  CHECKS_DATABASE_USER: ${{ secrets.CHECKS_DATABASE_USER }}
  CHECKS_DATABASE_PASSWORD: ${{ secrets.CHECKS_DATABASE_PASSWORD }}
  PYTHONIOENCODING: utf-8
  clickhouse_path: ${{ inputs.package }}
  version: ${{ inputs.version }}
  artifacts: ${{ inputs.artifacts }}
  args: --test-to-end
    --no-colors
    --local
    --clickhouse ${{ inputs.package }}
    --clickhouse-version ${{ inputs.version }}
    --collect-service-logs
    --output ${{ inputs.output_format }}
    --parallel ${{ vars.PARALLEL }}
    --attr project="${GITHUB_REPOSITORY}" project.id="${GITHUB_REPOSITORY_ID}" user.name="${GITHUB_ACTOR}" version="${{ inputs.version }}" package="${{ inputs.package }}" repository="https://github.com/Altinity/clickhouse-regression" commit.hash="${GITHUB_SHA}" job.id="${GITHUB_RUN_ID}" job.url="${GITHUB_SERVER_URL}/${GITHUB_REPOSITORY}/actions/runs/${GITHUB_RUN_ID}" arch="$(uname -i)" report.url=$SUITE_REPORT_INDEX_URL
    --log raw.log
    ${{ inputs.flags != 'none' && inputs.flags || ''}}
    ${{ inputs.extra_args }}
  artifact_paths: |
    ./report.html
    ./*.log.txt
    ./*.log
    ./*.html
    ./*/_instances/*.log
    ./*/_instances/*/logs/*.log
    ./*/*/_instances/*/logs/*.log
    ./*/*/_instances/*.log

jobs:
  aes_encryption:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 180
    env:
      SUITE: aes_encryption
    if: ${{ inputs.suite == 'all' || inputs.suite == 'aes_encryption' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.SUITE }}-artifacts
          path: ${{ env.artifact_paths}}

  aggregate_functions:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 360
    env:
      SUITE: aggregate_functions
    if: ${{ inputs.suite == 'all' || inputs.suite == 'aggregate_functions' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.SUITE }}-artifacts
          path: ${{ env.artifact_paths}}

  atomic_insert:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 180
    env:
      SUITE: atomic_insert
    if: ${{ inputs.suite == 'all' || inputs.suite == 'atomic_insert' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.SUITE }}-artifacts
          path: ${{ env.artifact_paths}}

  alter_replace_partition:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 600
    env:
      SUITE: alter
      STORAGE: /replace_partition
    if: ${{ inputs.suite == 'all' || inputs.suite == 'alter_all' || inputs.suite == 'alter_replace_partition' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              --only "/alter/replace partition/*"
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.SUITE }}-replace-partition-artifacts
          path: ${{ env.artifact_paths}}

  alter_attach_partition:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 1200
    env:
      SUITE: alter
      STORAGE: /attach_partition
    if: ${{ inputs.suite == 'all' || inputs.suite == 'alter_all' || inputs.suite == 'alter_attach_partition' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              --only "/alter/attach partition/*"
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.SUITE }}-attach-partition-artifacts
          path: ${{ env.artifact_paths}}

  alter_move_partition:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 300
    env:
      SUITE: alter
      STORAGE: /move_partition
    if: ${{ inputs.suite == 'all' || inputs.suite == 'alter_all' || inputs.suite == 'alter_move_partition' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              --only "/alter/move partition/*"
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.SUITE }}-move-partition-artifacts
          path: ${{ env.artifact_paths}}
  
  attach:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 300
    env:
      SUITE: attach
    if: ${{ inputs.suite == 'all' || inputs.suite == 'attach' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              --only "/attach/*"
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.SUITE }}-artifacts
          path: ${{ env.artifact_paths}}

  base_58:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 180
    env:
      SUITE: base_58
    if: ${{ inputs.suite == 'all' || inputs.suite == 'base_58' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.SUITE }}-artifacts
          path: ${{ env.artifact_paths}}

  benchmark_aws:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 240
    env:
      SUITE: ontime_benchmark
      STORAGE: /aws
    if: ${{ inputs.suite == 'benchmark_aws' || inputs.suite == 'benchmark_all' || inputs.suite == 'all_aws' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/benchmark.py
              --storage aws_s3
              --aws-s3-bucket ${{ secrets.AWS_BUCKET }}
              --aws-s3-region ${{ secrets.AWS_REGION }}
              --aws-s3-key-id ${{ secrets.AWS_KEY_ID }}
              --aws-s3-access-key ${{ secrets.AWS_ACCESS_KEY }}
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: benchmark-aws-artifacts
          path: ${{ env.artifact_paths}}

  benchmark_gcs:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 240
    env:
      SUITE: ontime_benchmark
      STORAGE: /gcs
    if: ${{ inputs.suite == 'benchmark_gcs' || inputs.suite == 'benchmark_all' || inputs.suite == 'all_gcs' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/benchmark.py
              --storage gcs
              --gcs-uri ${{ secrets.GCS_URI }}
              --gcs-key-id ${{ secrets.GCS_KEY_ID }}
              --gcs-key-secret ${{ secrets.GCS_KEY_SECRET }}
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: benchmark-gcs-artifacts
          path: ${{ env.artifact_paths}}

  benchmark_minio:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 180
    env:
      SUITE: ontime_benchmark
      STORAGE: /minio
    if: ${{ inputs.suite == 'all' || inputs.suite == 'benchmark_all' || inputs.suite == 'benchmark_minio' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/benchmark.py
              --storage minio
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: benchmark-minio-artifacts
          path: ${{ env.artifact_paths}}

  clickhouse_keeper:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 360
    env:
      SUITE: clickhouse_keeper
      STORAGE: /no_ssl
    if: ${{ inputs.suite == 'all' || inputs.suite == 'clickhouse_keeper' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.SUITE }}-artifacts
          path: ${{ env.artifact_paths}}

  clickhouse_keeper_ssl:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 240
    env:
      SUITE: clickhouse_keeper
      STORAGE: /ssl
    if: ${{ inputs.suite == 'all' || inputs.suite == 'clickhouse_keeper' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              --ssl
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.SUITE }}-ssl-artifacts
          path: ${{ env.artifact_paths}}

  clickhouse_keeper_failover:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 180
    env:
      SUITE: clickhouse_keeper_failover
      STORAGE: /failover
    if: ${{ inputs.suite == 'all' || inputs.suite == 'clickhouse_keeper_failover' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.SUITE }}-artifacts
          path: ${{ env.artifact_paths}}
  
  data_lakes:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 180
    env:
      SUITE: data_lakes
    if: ${{ inputs.suite == 'all' || inputs.suite == 'data_lakes' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.SUITE }}-artifacts
          path: ${{ env.artifact_paths}}

  data_types:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 180
    env:
      SUITE: data_types
    if: ${{ inputs.suite == 'all' || inputs.suite == 'data_types' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.SUITE }}-artifacts
          path: ${{ env.artifact_paths}}

  datetime64_extended_range:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 180
    env:
      SUITE: datetime64_extended_range
    if: ${{ inputs.suite == 'all' || inputs.suite == 'datetime64_extended_range' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.SUITE }}-artifacts
          path: ${{ env.artifact_paths}}

  disk_level_encryption:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 180
    env:
      SUITE: disk_level_encryption
    if: ${{ inputs.suite == 'all' || inputs.suite == 'disk_level_encryption' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.SUITE }}-artifacts
          path: ${{ env.artifact_paths}}

  dns:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 180
    env:
      SUITE: dns
    if: ${{ inputs.suite == 'all' || inputs.suite == 'dns' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.SUITE }}-artifacts
          path: ${{ env.artifact_paths}}

  engines:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 180
    env:
      SUITE: engines
    if: ${{ inputs.suite == 'all' || inputs.suite == 'engines' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.SUITE }}-artifacts
          path: ${{ env.artifact_paths}}

  example:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 180
    env:
      SUITE: example
    if: ${{ inputs.suite == 'all' || inputs.suite == 'example' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.SUITE }}-artifacts
          path: ${{ env.artifact_paths}}

  extended_precision_data_types:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 180
    env:
      SUITE: extended_precision_data_types
    if: ${{ inputs.suite == 'all' || inputs.suite == 'extended_precision_data_types' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.SUITE }}-artifacts
          path: ${{ env.artifact_paths}}

  functions:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 180
    env:
      SUITE: functions
    if: ${{ inputs.suite == 'all' || inputs.suite == 'functions' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.SUITE }}-artifacts
          path: ${{ env.artifact_paths}}

  jwt_authentication:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 180
    env:
      SUITE: jwt_authentication
    if: ${{ inputs.suite == 'all' || inputs.suite == 'jwt_authentication' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.SUITE }}-artifacts
          path: ${{ env.artifact_paths}}

  kafka:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 180
    env:
      SUITE: kafka
    if: ${{ inputs.suite == 'all' || inputs.suite == 'kafka' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.SUITE }}-artifacts
          path: ${{ env.artifact_paths}}

  kerberos:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 180
    env:
      SUITE: kerberos
    if: ${{ inputs.suite == 'all' || inputs.suite == 'kerberos' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.SUITE }}-artifacts
          path: ${{ env.artifact_paths}}

  key_value:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 180
    env:
      SUITE: key_value
    if: ${{ inputs.suite == 'all' || inputs.suite == 'key_value' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.SUITE }}-artifacts
          path: ${{ env.artifact_paths}}

  ldap_authentication:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 180
    env:
      SUITE: ldap/authentication
    if: ${{ inputs.suite == 'all' || inputs.suite == 'ldap' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ldap-authentication-artifacts
          path: ${{ env.artifact_paths}}

  ldap_external_user_directory:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 180
    env:
      SUITE: ldap/external_user_directory
    if: ${{ inputs.suite == 'all' || inputs.suite == 'ldap' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ldap-external_user_directory-artifacts
          path: ${{ env.artifact_paths}}

  ldap_role_mapping:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 180
    env:
      SUITE: ldap/role_mapping
    if: ${{ inputs.suite == 'all' || inputs.suite == 'ldap' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ldap-role_mapping-artifacts
          path: ${{ env.artifact_paths}}

  lightweight_delete:
    runs-on: [self-hosted, arm64, type-cax31, image-arm-app-docker-ce]
    timeout-minutes: 180
    env:
      SUITE: lightweight_delete
    if: ${{ inputs.suite == 'all' || inputs.suite == 'lightweight_delete' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.SUITE }}-artifacts
          path: ${{ env.artifact_paths}}

  memory:
    runs-on: [self-hosted, arm64, type-cax31, image-arm-app-docker-ce]
    timeout-minutes: 600
    env:
      SUITE: memory
    if: ${{ inputs.suite == 'all' || inputs.suite == 'memory' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.SUITE }}-artifacts
          path: ${{ env.artifact_paths}}

  parquet:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 300
    env:
      SUITE: parquet
      STORAGE: /no_s3
    if: ${{ inputs.suite == 'all' || inputs.suite == 'parquet' || inputs.suite == 'parquet_all'}}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.SUITE }}-artifacts
          path: ${{ env.artifact_paths}}

  parquet_minio:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 300
    env:
      SUITE: parquet
      STORAGE: /minio
    if: ${{ inputs.suite == 'all' || inputs.suite == 'parquet_minio' || inputs.suite == 'parquet_all'}}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              --storage minio
              --only "/parquet/minio/*"
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.SUITE }}-minio-artifacts
          path: ${{ env.artifact_paths}}

  parquet_aws_s3:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 300
    env:
      SUITE: parquet
      STORAGE: /aws_s3
    if: ${{ inputs.suite == 'parquet_s3' || inputs.suite == 'parquet_all' || inputs.suite == 'all_aws' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              --storage aws_s3
              --aws-s3-bucket ${{ secrets.AWS_BUCKET }}
              --aws-s3-region ${{ secrets.AWS_REGION }}
              --aws-s3-key-id ${{ secrets.AWS_KEY_ID }}
              --aws-s3-access-key ${{ secrets.AWS_ACCESS_KEY }}
              --only "/parquet/aws s3/*"
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.SUITE }}-aws-artifacts
          path: ${{ env.artifact_paths}}

  part_moves_between_shards:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 180
    env:
      SUITE: part_moves_between_shards
    if: ${{ inputs.suite == 'all' || inputs.suite == 'part_moves_between_shards' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.SUITE }}-artifacts
          path: ${{ env.artifact_paths}}

  rbac:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 540
    env:
      SUITE: rbac
    if: ${{ inputs.suite == 'all' || inputs.suite == 'rbac' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.SUITE }}-artifacts
          path: ${{ env.artifact_paths}}

  s3_aws:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 300
    env:
      SUITE: s3
      STORAGE: /aws
    if: ${{ inputs.suite == 's3_aws' || inputs.suite == 's3_all' || inputs.suite == 'all_aws' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              --storage aws_s3
              --aws-s3-bucket ${{ secrets.AWS_BUCKET }}
              --aws-s3-region ${{ secrets.AWS_REGION }}
              --aws-s3-key-id ${{ secrets.AWS_KEY_ID }}
              --aws-s3-access-key ${{ secrets.AWS_ACCESS_KEY }}
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.SUITE }}-aws-artifacts
          path: ${{ env.artifact_paths}}

  s3_azure:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 300
    env:
      SUITE: s3
      STORAGE: /azure
    if: ${{ inputs.suite == 's3_azure' || inputs.suite == 's3_all' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              --storage azure
              --azure-account-name ${{ secrets.AZURE_ACCOUNT_NAME }}
              --azure-storage-key ${{ secrets.AZURE_STORAGE_KEY }}
              --azure-container ${{ secrets.AZURE_CONTAINER_NAME }}
              ${{ env.args }} || EXITCODE=$?;
              .github/add_link_to_logs.sh;
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.SUITE }}-azure-artifacts
          path: ${{ env.artifact_paths}}

  s3_gcs:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 180
    env:
      SUITE: s3
      STORAGE: /gcs
    if: ${{ inputs.suite == 's3_gcs' || inputs.suite == 's3_all' || inputs.suite == 'all_gcs' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              --storage gcs
              --gcs-uri ${{ secrets.GCS_URI }}
              --gcs-key-id ${{ secrets.GCS_KEY_ID }}
              --gcs-key-secret ${{ secrets.GCS_KEY_SECRET }}
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.SUITE }}-gcs-artifacts
          path: ${{ env.artifact_paths}}

  s3_minio:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 180
    env:
      SUITE: s3
      STORAGE: /minio
    if: ${{ inputs.suite == 'all' || inputs.suite == 's3_all' || inputs.suite == 's3_minio' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              --storage minio
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.SUITE }}-minio-artifacts
          path: ${{ env.artifact_paths}}

  selects:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 180
    env:
      SUITE: selects
    if: ${{ inputs.suite == 'all' || inputs.suite == 'selects' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.SUITE }}-artifacts
          path: ${{ env.artifact_paths}}

  session_timezone:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 180
    env:
      SUITE: session_timezone
    if: ${{ inputs.suite == 'all' || inputs.suite == 'session_timezone' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.SUITE }}-artifacts
          path: ${{ env.artifact_paths}}

  ssl_server:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 360
    env:
      SUITE: ssl_server
    if: ${{ inputs.suite == 'all' || inputs.suite == 'ssl_server' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.SUITE }}-artifacts
          path: ${{ env.artifact_paths}}

  tiered_storage_aws:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 180
    env:
      SUITE: tiered_storage
      STORAGE: /aws
    if: ${{ inputs.suite == 'tiered_storage_aws' || inputs.suite == 'tiered_storage_all' || inputs.suite == 'all_aws' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              --with-s3amazon
              --aws-s3-access-key ${{ secrets.AWS_ACCESS_KEY }}
              --aws-s3-key-id ${{ secrets.AWS_KEY_ID }}
              --aws-s3-uri https://s3.${{ secrets.AWS_REGION}}.amazonaws.com/${{ secrets.AWS_BUCKET }}/data/
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.SUITE }}-aws-artifacts
          path: ${{ env.artifact_paths}}

  tiered_storage_gcs:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 180
    env:
      SUITE: tiered_storage
      STORAGE: /gcs
    if: ${{ inputs.suite == 'tiered_storage_gcs' || inputs.suite == 'tiered_storage_all' || inputs.suite == 'all_gcs' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              --with-s3gcs
              --gcs-uri ${{ secrets.GCS_URI }}
              --gcs-key-id ${{ secrets.GCS_KEY_ID }}
              --gcs-key-secret ${{ secrets.GCS_KEY_SECRET }}
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.SUITE }}-gcs-artifacts
          path: ${{ env.artifact_paths}}

  tiered_storage_local:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 180
    env:
      SUITE: tiered_storage
    if: ${{ inputs.suite == 'all' || inputs.suite == 'tiered_storage_local' || inputs.suite == 'tiered_storage_all' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.SUITE }}-artifacts
          path: ${{ env.artifact_paths}}

  tiered_storage_minio:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 180
    env:
      SUITE: tiered_storage
      STORAGE: /minio
    if: ${{ inputs.suite == 'all' || inputs.suite == 'tiered_storage_minio' || inputs.suite == 'tiered_storage_all' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              --with-minio
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.SUITE }}-minio-artifacts
          path: ${{ env.artifact_paths}}

  window_functions:
    runs-on: [self-hosted, arm64, type-cax41, image-arm-app-docker-ce]
    timeout-minutes: 180
    env:
      SUITE: window_functions
    if: ${{ inputs.suite == 'all' || inputs.suite == 'window_functions' }}
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref }}

      - name: ğŸ› ï¸ Setup
        run: .github/setup.sh

      - name: ğŸ§ª Run ${{ env.SUITE }} suite
        run: python3
              -u ${{ env.SUITE }}/regression.py
              ${{ env.args }} || EXITCODE=$?; 
              .github/add_link_to_logs.sh; 
              exit $EXITCODE

      - name: ğŸ“ Create and upload logs
        if: always()
        run: .github/create_and_upload_logs.sh ${{ vars.UPLOAD_LOGS }}

      - name: ğŸ“¤ Upload logs to results database
        if: always()
        timeout-minutes: 5
        run: .github/upload_results_to_database.sh ${{ vars.UPLOAD_LOGS }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.SUITE }}-artifacts
          path: ${{ env.artifact_paths}}
